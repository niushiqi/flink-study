##网易流计算平台Sloth的搭建

1. 管理平台架构
    - Web 端：公用 Sloth 的前端平台不同
    - Sloth-Server 模块：包括用户的权限管理，会话管理，任务开发，元数据管理，任务运维，标签管理，内核调度，文件管理（控制初始状态的执行）  
      内核调度（父子进程的架构。常驻子进程模式（处理启动，停止，语法检查，表结构解析，获取提交结果的请求）和临时子进程模式（SQL的Debug））  
      任务开发（任务调试、任务 Tab 页、语法检查、任务标签、元数据管理、用户资源文件管理以及任务复制等）
    - Sloth-Bill 模块：主要是对资源以及用量的统计
    - Sloth-admin 模块：包括监控，报警，任务恢复，以及任务诊断（控制所有与 YARN 相关的状态交互）  
      日志检索（Filebeat，Kafka，Logstash，ES）  
      监控（influxdb metric report 组件，ntsdb时序数据库）
    - Sloth-Kernel 模块：负责任务执行、语法检测以及 SQL 调试

1. 管理平台启动流程  
首先，Server会接收到来自用户的启动请求，之后会创建一个分布式锁，Admin会监控这个锁。然后，Server向Kernel提交任务，提交之后会立即返回，返回之后就会立即更新数据库中的状态，将状态更新为启动中，这样在页面上用户就能够看到任务是启动中的状态了。接下来，Server就会等待内核的Shell脚本的执行结果，如果Shell脚本执行成功了，就会去写Zookeeper，写完Zookeeper之后Admin模块就会马上检测到Zookeeper节点有状态发生了修改，Admin会立即去获取YARN上的任务状态，如果获取到任务状态是运行中，就将数据库的任务状态更新为运行中，这会在前端看到任务就已经是运行状态了。最后一步是Admin更为完数据库之后，会释放掉Zookeeper上的锁，其他人这时候就可以操作这个任务了

1. 例子-数据实时同步  
AI智能对话服务场景中，客户在前端配置知识库数据，通过Sloth实时处理后，写入到ES中供查询场景使用。

1. 例子-实时数仓  
收集日志、埋点，Kafka，Sloth，汇总以及维度关联等操作，Redis，Kudu

1. 例子-电商应用-数据分析  
Hubble，Kafka，Sloth清洗，Kafka，Sloth关联维度，Kudu
 
1. 例子-电商应用-搜索推荐  
应用日志，Sloth数据清洗和维度拆分，Kafka，Sloth实时统计多维特征，Redis